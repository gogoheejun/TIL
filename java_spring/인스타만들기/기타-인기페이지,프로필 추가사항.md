# 69ê°•-ì¸ê¸°í˜ì´ì§€ êµ¬í˜„

[ImageController.java](http://imagecontroller.java)ì—ì„œ í•´ë³´ì. ê·¼ë° ì™œ apiì—ì„œ ì•ˆí•˜ê³  ë°”ë¡œ ê·¸ëƒ¥ ì»¨íŠ¸ë¡¤ëŸ¬ì—í•˜ëƒ?

apiíŒ¨í‚¤ì§€ì—ëŠ” ë°ì´í„°ë¥¼ ë¦¬í„´í•˜ëŠ” ì• ë“¤ë§Œ ëª¨ì•„ë†“ì€ê±°ë‹ˆê¹Œ! ì§€ê¸ˆ ë‚´ê°€ í•˜ë ¤ëŠ”ê±´ ì¸ê¸°í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ”ê±´ë° ë¶€ìˆ˜ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë‹´ì•„ê°€ëŠ” ê±°ë‹ˆê¹Œ ê·¸ëƒ¥ ì»¨íŠ¸ë¡¤ëŸ¬ì„. apiì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ajaxë¡œ ë¶€ë¥¼ë•Œ ì“°ëŠ”ê±°ì„(ë˜ëŠ” ì•ˆë“œë¡œì´ë“œ, iosìš”ì²­)

ê³ ë¡œ ImageControllerì— ë‹¤ìŒì²˜ëŸ¼...ì¸ê¸°ì‚¬ì§„()ì„ í˜¸ì¶œí•˜ê³  ê²°ê³¼ë¥¼ model.addAttribute()í•œë‹¤

```java
@GetMapping({"/image/popular"})
	public String popular(Model model) {
		
		List<Image> images = imageService.ì¸ê¸°ì‚¬ì§„();
		model.addAttribute("images",images);
		
		return "image/popular";
	}
```

ì´ì œ imageService

```java
public class ImageService {

	private final ImageRepository imageRepository;
	
	@Transactional(readOnly = true)
	public List<Image> ì¸ê¸°ì‚¬ì§„(){
		return imageRepository.mPopular();
	}
```

ê¸€êµ¬ repositoryì— mPopular()ì •ì˜í•´ì¤Œ

```java
public interface ImageRepository extends JpaRepository<Image, Integer> {

	@Query(value="SELECT * FROM image WHERE userId IN (SELECT toUserId FROM subscribe WHERE fromUserId = :principalId) ORDER BY id DESC",nativeQuery=true)
	Page<Image> mStory(int principalId,Pageable pageable);
	
	@Query(value="SELECT i.* FROM image i INNER JOIN (SELECT imageId, COUNT(imageId) likeCount FROM likes GROUP BY imageId) c ON i.id = c.imageId ORDER BY likeCount DESC",nativeQuery = true)
	List<Image> mPopular();
}
```

ê·¼ë° ì¿¼ë¦¬ ã„±ì–´ë ¤ì›Œ...

ì¿¼ë¦¬ì˜ ëª©í‘œ: **ì¢‹ì•„ìš”ë¥¼ ë°›ì€ ëª¨ë“  ì´ë¯¸ì§€ë“¤ì„ ì…€ë ‰íŠ¸, ë‹¨ ìˆœì„œëŠ” ì œì¼ ë§ì´ ë°›ì€ìˆœ**

ìˆœì„œëŒ€ë¡œ í•´ë³´ì

ì•„ë˜ì²˜ëŸ¼ í•˜ë©´?

```sql
SELECT * FROM image WHERE id IN (2,3); ì²˜ëŸ¼ í•˜ë©´ idê°€ 2,3ë²ˆì¸ imageë¥¼ ë¶ˆëŸ¬ì˜´
```

![01](https://user-images.githubusercontent.com/78577071/127130234-62dda6b6-2a60-44ea-8836-a4e6d6951c6b.png)

ê·¸ëŸ¼ ì € ê´„í˜¸(2,3) ì•ˆì— selectë¬¸ì„ ë„£ìœ¼ë©´ ë¼. 

â†’ex) ì•„ë˜ì²˜ëŸ¼ í•˜ë©´, likesì—ì„œ likeCountìˆœì„œëŒ€ë¡œ imagId ë‘likeCountë½‘ëŠ”ê±°ì•¼

```sql
SELECT imageId, COUNT(imageId) likeCount FROM likes 
GROUP BY imageId ORDER BY likeCount DESC;
```

![02](https://user-images.githubusercontent.com/78577071/127130251-af262454-e3ae-432e-8038-4932e0413612.png)


ê·¼ë° ì§€ê¸ˆ ì›í•˜ëŠ” ê±´ IN ()ì•ˆì— idë§Œ ë“¤ì–´ê°€ì•¼ í•˜ëŠ”ë°, ë‘ê°œì¹¼ëŸ¼ì€ ëª»ë“¤ì–´ê°€ë‹ˆê¹Œ ë‹¤ì‹œ ì…€ë ‰íŠ¸

```sql
SELECT imageId FROM(
	SELECT imageId, COUNT(imageId) likeCount
	FROM likes GROUP BY imageId ORDER BY likeCount DESC)c;  
//ë§ˆì§€ë§‰ì— cëŠ” ë³„ì¹­ì„ ì¹´ìš´íŠ¸ë‹ˆê¹Œ cã…‹ã…‹
```

![03](https://user-images.githubusercontent.com/78577071/127130275-ce6d9bd9-a128-4a47-9fe9-4c0ee05ecc17.png)

ìµœì¢…ì ìœ¼ë¡œ ìœ„ì˜ idë¥¼ í† ëŒ€ë¡œ ì…€ë ‰íŠ¸ í•˜ë©´ ë¼!!

```sql
SELECT * FROM image WHERE id IN (
	SELECT imageId FROM (
		SELECT imageId, COUNT(imageId) likeCount
		FROM likes GROUP BY imageId ORDER BY likeCount DESC) c
);
```

![04](https://user-images.githubusercontent.com/78577071/127130291-ba035c53-c89d-4273-b23d-5a5ee0851638.png)

ì•„ë‹ˆ ê·¼ë° ë¬¸ì œì ì´ ìˆì–´. ìœ„ì—ì„  ìš´ì´ ì¢‹ì•„ì„œ 1,2ìˆœì„œëŒ€ë¡œ ë‚˜ì™”ì§€ë§Œ, ì¢‹ì•„ìš”ê°€ ë§Œì•½ 2ê°€ ë” ë‚˜ì™€ë„ 1,2ìˆœìœ¼ë¡œ ë‚˜ì˜´. 

why? 

SELECT * FROM image WHERE id IN () ì—ì„œ **IN()ì•ˆì— (1,2)ê°€ ë˜ë‚˜ (2,1)ì´ ë˜ë‚˜ ë˜‘ê°™ì´ ë‚®ì€ ìˆœì„œì¸ 1,2ë¡œ ì •ë ¬ì´ ë˜ì–´ ë‚˜ì˜¨ë‹¤.**

ğŸ˜±ìœ¼ì—‡...!!!!!!!!!ê·¸ëŸ¼ ë‹¤ì‹œ..!!!!!!!!!!!!!!!!!!!

ì°¨ê·¼ì°¨ê·¼ í•´ë³´ë©´

```sql
SELECT * FROM image;
```

![05](https://user-images.githubusercontent.com/78577071/127130300-304356ca-e64f-437e-9753-7937ad741022.png)

ì´ë¯¸ì§€ë¥¼ ë³´ë©´ imageì˜ idê°€ ìˆì§€

ì•„ë˜ì²˜ëŸ¼ í•˜ë©´ imageIdì™€ ì¢‹ì•„ìš”ìˆ˜(likeCount)ê°€ ìˆì§€ . ê·¸ëŸ¼ ë‘˜ì´ í•©ì¹˜ë©´ ë˜ê² ë‹¤!!

```sql
SELECT imageId, COUNT(imageId) likeCount FROM likes GROUP BY imageId;
```

![06](https://user-images.githubusercontent.com/78577071/127130316-00e19cc3-8628-4e44-8d62-77f07719b05d.png)

í•©ì¹˜ì! ì–´ì¼€? imageí…Œì´ë¸”ê³¼ ë°”ë¡œ ìœ„ì˜ ë‚´ê°€ ì…€ë ‰íŠ¸í•œ ê°€ìƒì˜ í…Œì´ë¸”ì„!

```sql
SELECT i.* FROM image i 
INNER JOIN (SELECT imageId, COUNT(imageId) likeCount FROM likes GROUP BY imageId) c 
ON i.id = c.imageId ORDER BY likeCount DESC;
```

**ON**ì—°ì‚°ìë¥¼ í†µí•´ imageí…Œì´ë¸”ì˜ idì™€ ê°€ìƒì˜í…Œì´ë¸”(c)ì˜ imageIdê°€ ê°™ìœ¼ë‹ˆê¹Œ ë‘˜ì´ ì—°ê²°í•˜ë¼ëŠ” ê²ƒì„. 

ê¸€êµ¬ ìµœì¢…ì ìœ¼ë¡œ select * ë¡œ ImageRepositoryì— ë„£ìœ¼ë©´ ì•ˆë¼. ì™œëƒë©´ Imageëª¨ë¸ì— ë§ê²Œ ë„£ì–´ì¤˜ì•¼ í•˜ë‹ˆê¹Œ. imgaeí…Œì´ë¸”ì˜ ê²ƒë§Œ ì…€ë ‰íŠ¸í•´ì¤˜ì•¼ í•¨â†’**i.*** 

![07](https://user-images.githubusercontent.com/78577071/127130341-f6953265-09af-47e4-b7b7-7d0e4f1bb935.png)

# 70ê°•-í”„ë¡œí•„í˜ì´ì§€ ì¢‹ì•„ìš” ì¹´ìš´íŠ¸ êµ¬í˜„

likeCountë¥¼ ì–´ë–»ê²Œ ì°¾ì§€?

UserControllerì˜ /user/{pageUserId}ë¥¼ ë³´ë©´ UserProfileDtoë¥¼ addAttributeí•˜ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŒ. UserProfileDtoì—ëŠ” Userê°€ ìˆê³  User ì•ˆì—ëŠ” List<Image>ê°€ ìˆê³ , Imageì—ëŠ” likeCountê°€ ìˆë‹¤!

ì˜¤ì¼€ì´ ğŸ‘

likCountëŠ” ê·¼ë° dbì— ìˆëŠ”ê²Œ ì•„ë‹ˆë¼, ImageServiceì—ì„œ ì´ë¯¸ì§€ìŠ¤í† ë¦¬()í•¨ìˆ˜ë¥¼ í†µí•´ ë‹¤ìŒì²˜ëŸ¼ ì§ì ‘ ë§Œë“¤ì—ˆì—ˆì–´

```java
@Transactional(readOnly = true)
	public Page<Image> ì´ë¯¸ì§€ìŠ¤í† ë¦¬(int principalId, Pageable pageable) {
		Page<Image> images = imageRepository.mStory(principalId, pageable);

		// imagesì— ì¢‹ì•„ìš” ìƒíƒœ ë‹´ê¸°
		images.forEach((image) -> {
			
			//ì¢‹ì•„ìš”ê°œìˆ˜
			image.setLikeCount(image.getLikes().size());
			
			//ë‚´ê°€ ì¢‹ì•„ìš”ëˆŒë €ëŠ”ì§€
			image.getLikes().forEach((like) -> {
				if (like.getUser().getId() == principalId) {// í•´ë‹¹ì´ë¯¸ì§€ì— ì¢‹ì•„ìš”í•œì‚¬ëŒë“¤ ì°¾ì•„ì„œ í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ëŒì´ ì¢‹ì•„ìš” í•œê±´ì§€ ë¹„êµ
					image.setLikeState(true);
				}
			});
		});

		return images;
	}
```

ê³ ë¡œ í˜„ì¬ ë‚´ í”„ë¡œí•„ì„ ë³´ì—¬ì£¼ëŠ” UserControllerê°€ ì´ë¯¸ì§€ìŠ¤í† ë¦¬() í•¨ìˆ˜ë¥¼ ë˜ ì“°ì§€ ì•ŠëŠ”ì´ìƒ Imageì˜ LikeCountëŠ” í……í…… ë¹ˆ ê°’ì´ì•¼.

ê³ ë¡œ ë‚´ê°€ ì§€ê¸ˆ íšŒì›í”„ë¡œí•„ ì˜¬ ë•Œ ì“°ëŠ” UserControllerì˜  userService.íšŒì›í”„ë¡œí•„() í•¨ìˆ˜ì—ì„œ Imageì˜ LikeCountë¥¼ dbì—ì„œ ë¶ˆëŸ¬ì™€ì„œ ì§€ì •í•´ì¤˜ì•¼ê² ì§€!!

í˜„ì¬ ë‹¤ìŒì²˜ëŸ¼ ë˜ì–´ìˆì–´.

```java
public class UserController {

	private final UserService userService;
	
	@GetMapping("/user/{pageUserId}")
	public String profile(@PathVariable int pageUserId, Model model,@AuthenticationPrincipal PrincipalDetails principalDetails) {
		UserProfileDto dto = userService.íšŒì›í”„ë¡œí•„(pageUserId, principalDetails.getUser().getId());
		model.addAttribute("dto",dto);
		return "user/profile";
	}
```

 dtoë¡œ ë°›ìœ¼ë‹ˆê¹Œ dtoì—ë‹¤ê°€ LikeCountë¥¼ ì¶”ê°€í•˜ë©´ ë ê¹Œ?

NoNo ğŸš«. ì‚¬ì§„ ã…ˆã„¹ì—¬ëŸ¬ê° ë° ê°ê°ì˜ ì‚¬ì§„ì— LikeCountë¥¼ ì„¤ì •í•´ì•¼ë¼. ì € ìœ„ ì²˜ìŒì— ì–¸ê¸‰í–ˆë“¯ dtoì•ˆì— userê°€ ìˆê³  ê·¸ ì•ˆì— Imageê°€ ìˆìœ¼ë‹ˆ, ê±°ê¸°ë‹¤ ì‘ì—…ì³ì•¼í•´.

ê³ ë¡œ, dtoëŠ” ê°€ë§Œíˆ ëƒ…ë‘ê³ , ë‚´ê°€ í”„ë¡œí•„í˜ì´ì§€ ë“¤ê°ˆë•Œ UserControllerì—ì„œ ë°œë™ë˜ëŠ” íšŒì›í”„ë¡œí•„()ë¡œ ê°€ì„œ userë¥¼ ì¡°ì‘í•˜ì. userEntityê°€ í˜„ì¬ ê·¸ í˜ì´ì§€ì˜ ì£¼ì¸ì´ë‹ˆê¹Œ userEntiyì´ìš©í•´ì„œ í•˜ë©´ë¼.

```java
@Transactional(readOnly=true)
	public UserProfileDto íšŒì›í”„ë¡œí•„(int pageUserId, int principalId) {
		UserProfileDto dto = new UserProfileDto();
		
		//ì›ë˜ ì¿¼ë¦¬ë¡œ í•˜ë©´, SELECT * FROM image WHERE userId=:userIdì„
		User userEntity = userRepository.findById(pageUserId).orElseThrow(()->{
			throw new CustomException("í•´ë‹¹ í”„ë¡œí•„ í˜ì´ì§€ëŠ” ì—†ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤");
		});
		
		dto.setUser(userEntity);
		dto.setPageOwnerState(pageUserId==principalId);//1ì€ í˜ì´ì§€ì£¼ì¸, -1ì€ ì£¼ì¸ì´ ì•„ë‹˜
		dto.setImageCount(userEntity.getImages().size());
		
		int subscribeState = subscribeRepository.mSubscribeState(principalId, pageUserId);
		int subscribeCount = subscribeRepository.mSubscribeCount(pageUserId);
		
		dto.setSubscribeState(subscribeState==1);
		dto.setSubscribeCount(subscribeCount);
		
=====================================ì—¬ê¸°!!!ì—¬ê¸°ì— ì¢‹ì•„ìš”ì¹´ìš´íŠ¸!!!!==================
		//ì¢‹ì•„ìš”ì¹´ìš´íŠ¸ ì¶”ê°€í•˜ê¸°
		userEntity.getImages().forEach(image->{
			image.setLikeCount(image.getLikes().size());
		});
		
		return dto;
	}
```

ëìœ¼ë©´,  profile.jspì— ì™€ì„œ ${image.likeCount} ë„£ìœ¼ë©´ ëœë‹¤!

```java
<!--ì•„ì´í…œë“¤-->
<c:forEach var="image" items="${dto.user.images}">
	<!-- ELí‘œí˜„ì‹ì—ì„œ ë³€ìˆ˜ëª…ì„ ì ìœ¼ë©´ getí•¨ìˆ˜ê°€ ìë™í˜¸ì¶œë¨ -->
	<div class="img-box">
		<a href=""> <img src="/upload/${image.postImageUrl}" />
		</a>
		<div class="comment">
			<a href="#" class=""> <i class="fas fa-heart"></i><span>${image.likeCount}</span>
			</a>
		</div>
	</div>
</c:forEach>
```

ì„±ê³µ!

![08](https://user-images.githubusercontent.com/78577071/127130352-9c792a7a-de7c-402b-8385-3cb91e707216.png)

# í”„ë¡œí•„í˜ì´ì§€ ìœ ì € ì‚¬ì§„ ë³€ê²½

í• ê²ƒ:

1. ìê¸° í˜ì´ì§€ì—ì„œë§Œ ì‚¬ì§„ë³€ê²½ê°€ëŠ¥í•˜ê²Œ.(pageUserId, principalId ë¹„êµ)
2. ì˜¬ë¦¬ë ¤ëŠ” ì´ë¯¸ì§€ë¥¼ putë°©ì‹(ajax)ë¡œ ì„œë²„ì— ì „ì†¡í•˜ê¸°-FormData ê°ì²´ ì´ìš©

ì´ì „ì— ì‚¬ì§„ ì—…ë¡œë“œí• ë•Œë„ ì‚¬ì§„ ì˜¬ë¦¬ê¸° í•´ë´¤ìŒ. ê·¼ë° ê·¸ë• captionì´ë‘ ê°™ì´ ë³´ë‚´ì„œ dtoë¥¼ ë”°ë¡œ ë§Œë“¤ì—ˆì—ˆìŒ. ì§€ê¸ˆì€ ê·¸ëƒ¥ ì‚¬ì§„ë§Œ ë³´ë‚´ëŠ” ìƒí™©ì´ì•¼

ë²„íŠ¼ í´ë¦­ì‹œ ë°œë™ë˜ëŠ” profile.jspì˜ profileImageUpload()í•¨ìˆ˜ì— ì¸ì ë‘ê°œ ì¶”ê°€ : í˜ì´ì§€ì£¼ì¸ ì•„ì´ë””, ë¡œê·¸ì¸í•œì‚¬ëŒ ì•„ì´ë””

```jsx
<button onclick="profileImageUpload(${dto.user.id},${principal.user.id})">ì‚¬ì§„ ì—…ë¡œë“œ</button>
```

ì´ì œ profile.jsê°€ì„œ í•¨ìˆ˜êµ¬í˜„. í˜ì´ì§€ ì£¼ì¸=ë¡œê·¸ì¸í•œì‚¬ëŒì¸ì§€ ì²´í¬. ê¸€êµ¬ ajaxì¶”ê°€

```jsx
// (3) ìœ ì € í”„ë¡œíŒŒì¼ ì‚¬ì§„ ë³€ê²½ (ì™„)
function profileImageUpload(pageUserId, principalId) {
	
	if(pageUserId != principalId){
		alert("í”„ë¡œí•„ ì‚¬ì§„ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ëŠ” ìœ ì €ì…ë‹ˆë‹¤");
		return;
	}
	
	$("#userProfileImageInput").click();

	$("#userProfileImageInput").on("change", (e) => {
		let f = e.target.files[0];

		if (!f.type.match("image.*")) {
			alert("ì´ë¯¸ì§€ë¥¼ ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤.");
			return;
		}
		
		//ì„œë²„ì— ì´ë¯¸ì§€ ì „ì†¡
		let profileImageForm = $("#userProfileImageForm")[0];
		console.log(profileImageForm);
		
		//FormData ê°ì²´ë¥¼ ì´ìš©í•˜ë©´ fromíƒœê·¸ì˜ í•„ë“œì™€ ê·¸ ê°’ì„ ë‚˜íƒ€ë‚´ëŠ” ì¼ë ¨ì˜ key/valueìŒì„ ë‹´ì„ ìˆ˜ ìˆë‹¤.
		let formData = new FormData(profileImageForm)
		//console.log(formData);
		$.ajax({
			type:"put",
			url:`/api/user/${principalId}/profileImageUrl`,
			data:formData,
			contentType:false, //í•„ìˆ˜. ìë™ìœ¼ë¡œ x-www-form-encodedë¡œ íŒŒì‹±ë˜ëŠ” ê±° ë°©ì§€
			processData:false, //í•„ìˆ˜. contentTypeì„ falseë¡œ ì¤¬ì„ ë•Œ ìë™ìœ¼ë¡œ QueryStringìœ¼ë¡œ ì„¤ì •ë˜ëŠ”ê±° í•´ì œ
			enctype:"multipart/form-data",
			dataType:"json"
		}).done(res=>{
			// ì‚¬ì§„ ì „ì†¡ ì„±ê³µì‹œ ì´ë¯¸ì§€ ë³€ê²½
			let reader = new FileReader();
			reader.onload = (e) => {
				$("#userProfileImage").attr("src", e.target.result);
			}
			reader.readAsDataURL(f); // ì´ ì½”ë“œ ì‹¤í–‰ì‹œ reader.onload ì‹¤í–‰ë¨.
		}).fail(error=>{
			console.log("ì˜¤ë¥˜",error);
		});
	});
}
```

ì»¨íŠ¸ë¡¤ëŸ¬(UserApiController)

~~apiì£¼ì†Œ {principalId} ì•ì— $ì ì–´ì„œ ë‘ì‹œê°„ ë‚ ë¦¼..ğŸ˜§~~

```jsx
public class UserApiController {

	private final UserService userService;
	private final SubscribeService subscribeService;
	
	@PutMapping("/api/user/{principalId}/profileImageUrl")
	public ResponseEntity<?> profileImageUrlUpdate(@PathVariable int principalId, MultipartFile profileImageFile,
		@AuthenticationPrincipal PrincipalDetails principalDetails){//MultipartFile profileImageFileì€ ì´ë¦„ì„ profile.jspì—ì„œ nameê°’ì´ë‘ ë˜‘ê°™ì´ í•´ì•¼ í•¨.
		User userEntity = userService.íšŒì›í”„ë¡œí•„ì‚¬ì§„ë³€ê²½(principalId,profileImageFile);
		principalDetails.setUser(userEntity);//ì„¸ì…˜ë³€ê²½
		return new ResponseEntity<>(new CMRespDto<>(1,"í”„ë¡œí•„ì‚¬ì§„ë³€ê²½ ì„±ê³µ",null), HttpStatus.OK);
	}
```

ì„œë¹„ìŠ¤(UserService)

```jsx
@Value("${file.path}") // ì—¬ê¸°ë‹¤ê°€ ë‹¤ ê²½ë¡œ ì•ˆì ê³  ymlíŒŒì¼êº¼ ê°€ì ¸ì˜¤ëŠ”ê±´ ê·¸ ê²½ë¡œë¥¼ ë‹¤ë¥¸ê³³ì—ì„œë„ ì“¸ìˆ˜ë„ ìˆìœ¼ë‹ˆê¹.
	private String uploadFolder;
	
	@Transactional
	public User íšŒì›í”„ë¡œí•„ì‚¬ì§„ë³€ê²½(int principalId, MultipartFile profileImageFile) {
		UUID uuid = UUID.randomUUID();// ëœë¤ìœ¼ë¡œ ì¤‘ë³µì•ˆë˜ëŠ” idë§Œë“¤ì–´ì¤Œ.(ëª‡ì‹­ì–µë¶„ì˜ 1ë¡œ ê°™ì€ê±° ë‚˜ì˜¬ìˆ˜ ìˆì§€ë§Œ íŒŒì¼ëª…ì´ë‘ í•©ì¹˜ë©´ ëª‡ì²œì–µë¶„ì˜ 1ë¨)
		String imageFileName = uuid + "_" + profileImageFile.getOriginalFilename();

		Path imageFilePath = Paths.get(uploadFolder + imageFileName);

		// í†µì‹ ,I/O ->ì˜ˆì™¸ê°€ ë°œìƒí• ìˆ˜ìˆìŒ.
		try {
			Files.write(imageFilePath, profileImageFile.getBytes());// ì´ë¯¸ì§€ë¥¼ ë°”ì´íŠ¸í™”í•´ì„œ ì„œë²„ê²½ë¡œì—ë‹¤ê°€ ë„£ìŒ
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		User userEntity = userRepository.findById(principalId).orElseThrow(()->{
			throw new CustomApiException("ìœ ì €ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		});
		userEntity.setProfileImageUrl(imageFileName);
		return userEntity;
	}//ë”í‹°ì²´í‚¹ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë¨
```

í”„ì‚¬ ë³€ê²½ì™„ë£Œ~ ê·€ì—¬ìš´ ëƒ¥ì´ğŸˆ

![09](https://user-images.githubusercontent.com/78577071/127130378-bf26cb76-c905-4dc6-aec5-2fcf451abf34.png)

ë³µìŠµí•˜ì!
