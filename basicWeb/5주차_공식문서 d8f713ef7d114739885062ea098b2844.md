# 5주차_공식문서



## **내 프로젝트를 서버에 올리기**

- 10) "웹서비스 런칭" 에 필요한 개념 소개

    이제 내가 만든 프로젝트를 배포해봅니다. 배포는 누구나 내 서비스를 사용할 수 있게 하기 위해서 작업들이에요.  웹 서비스를 런칭하는 거죠!

    - 웹 서비스를 런칭하기 위해 클라이언트의 요청에 항상 응답해줄 수 있는 서버에 프로젝트를 실행시켜줄 거에요.
    - 언제나 요청에 응답하려면, 
    1) 컴퓨터가 **항상** 켜져있고 프로그램이 실행되어 있어야하고, 
    2) 모두가 접근할 수 있는 공개 주소인 공개 IP 주소(Public IP Address)로 나의 웹 서비스에 **접근할 수 있도록** 해야해요.
    - 서버는 그냥 컴퓨터라는거 기억나시죠? 외부 접속이 가능하게 설정한 다음에 내 컴퓨터를 서버로 사용할 수도 있어요.
    - 우리는 AWS 라는 클라우드 서비스에서 편하게 서버를 관리하기 위해서 항상 켜 놓을 수 있는 컴퓨터인 EC2 사용권을 구입해 서버로 사용할 겁니다.
    - **[열 걸음 더 🏃]** IP 주소와 포트
        - 사실 우리가 접속하는 컴퓨터는 숫자로 되어있는 주소(IP 주소)가 붙어있어요. 우리가 아는 URL 은 우리가 알아보기 쉽게 하는 등의 이유로 IP 주소를 알파벳으로 바꾼 거에요. 이렇게 변환해주는 시스템을 DNS 라고 합니다.

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/week06_ip.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/week06_ip.png)

        - IP 주소(줄여서 IP라고 부릅니다)

            : 컴퓨터가 통신할 수 있도록 컴퓨터마다 가지는 고유한 주소라고 생각하면 됩니다. 정확히는 네트워크가 가능한 모든 기기가 통신할 수 있도록 가지고 있는 특수한 번호입니다.  서버는 하나의 주소를 가지고 있습니다. 

        - 포트(port)

            : 하나의 IP에 여러 포트가 있습니다. 하나의 포트에 하나의 프로그램을 실행시킬 수 있습니다. 

## 10**. AWS 서버 구매하기**

- 11) EC2 서버 구매하기
    - AWS EC2 서버 사기
        - **[코드스니펫] - EC2 콘솔페이지**

            ```bash
            [https://ap-northeast-2.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-2](https://ap-northeast-2.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-2#Instances:sort=instanceId)
            ```

        - 구매 화면들 따라하기

            ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2011.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2011.png)

            ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2012.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2012.png)

            ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2013.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2013.png)

            ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2014.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2014.png)

            ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2015.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2015.png)

- 12) EC2 서버 종료하는 방법 (1년 후 자동결제 방지!)

    **중지 또는 종료하는 법. 무료 기간(1년) 후 결제가 되기 전에, 이렇게 종료하세요!**

    대상 인스턴스에 마우스 우클릭 > '인스턴스 상태' 를 클릭합니다. 중지 또는 종료 중 하나를 클릭하면 명령을 실행합니다.

    ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/_2020-04-29__11.15.14.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/_2020-04-29__11.15.14.png)

- 13) EC2에 접속하기
    - AWS EC2에 접속하기 (준비 상식 편)
        - SSH(Secure Shell Protocol)
            - 다른 컴퓨터에 접속할 때 쓰는 프로그램입니다. 다른 것들 보다 보안이 상대적으로 뛰어납니다.
            - 접속할 컴퓨터가 22번 포트가 열려있어야 접속 가능합니다. AWS EC2의 경우, 이미 22번 포트가 열려있습니다. 확인해볼까요?

            ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2016.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2016.png)

    - AWS EC2에 접속하기
        - Mac OS: Mac은 ssh가 있어서, 명령어로 바로 접근 가능!
            - 터미널을 열기 (spotlight에 terminal 입력)
            - 방금 받은 내 Keypair의 접근 권한을 바꿔주기

                ```bash
                sudo chmod 400 받은키페어를끌어다놓기 
                ```

            - SSH로 접속하기

                ```bash
                ssh -i 받은키페어를끌어다놓기 ubuntu@AWS에적힌내아이피
                ```

                예) 아래와 비슷한 생김새!

                ```bash
                ssh -i /path/my-key-pair.pem ubuntu@13.125.250.20
                ```

        - Window: ssh가 없으므로, git bash라는 프로그램을 이용!
            - gitbash를 실행하고, 아래를 입력!

                ```bash
                ssh -i 받은키페어를끌어다놓기 ubuntu@AWS에적힌내아이피
                ```

                예) 아래와 비슷한 생김새!

                ```bash
                ssh -i /path/my-key-pair.pem ubuntu@13.125.250.20
                ```

            - Key fingerprint 관련 메시지가 나올 경우 Yes를 입력해주세요!
            - git bash를 종료할 때는 exit 명령어를 입력하여 ssh 접속을 먼저 끊어주세요.
- 14) 간단한 리눅스 명령어 연습하기
    - 리눅스는 윈도우 같지 않아서, '쉘 명령어'를 통해 OS를 조작한다. (일종의 마우스 역할)

    [가장 많이 쓰는 몇 가지 명령어]

    - 팁! 리눅스 커널에서 윗화살표를 누르면 바로 전에 썼던 명령어가 나옵니다.

    ```bash
    ls: 내 위치의 모든 파일을 보여준다.
    
    pwd: 내 위치(폴더의 경로)를 알려준다.
    
    mkdir: 내 위치 아래에 폴더를 하나 만든다.
    
    cd [갈 곳]: 나를 [갈 곳] 폴더로 이동시킨다.
    
    cd .. : 나를 상위 폴더로 이동시킨다.
    
    cp -r [복사할 것] [붙여넣기 할 것]: 복사 붙여넣기
    
    rm -rf [지울 것]: 지우기
    
    sudo [실행 할 명령어]: 명령어를 관리자 권한으로 실행한다.
    sudo su: 관리가 권한으로 들어간다. (나올때는 exit으로 나옴)
    ```

## 11. 서버 세팅하기

- 15) filezilla를 이용해서, 간단한 python 파일을 올려봅니다.
    - 서버에 업로드 할 간단한 파일을 다운로드 받습니다.
        - **[코드스니펫] - [test.py](http://test.py)**

            [test.py](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/test.py)

        예) [test.py](http://test1.py)

        ```python
        # 아주 간단하게, 이 정도만 적어볼까요?
        # 그리고 적당한 곳에 파일을 저장해봅니다.
        print('hello sparta!!')
        ```

    - 파일질라 실행, 다음과 같이 설정

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2017.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2017.png)

    - 정보들을 입력하고, ok 누르면 서버의 파일들을 볼 수 있음
    (Host: 내 EC2서버의 ip // User: ubuntu 로 입력)

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2018.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2018.png)

    - 마우스로 드래그 해서 파일을 업로드/다운로드하면 됩니다!
      (자, 그럼 이제 간단한 파이썬 파일을 하나 만들어서 업로드 해볼까요?)

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2019.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2019.png)

- 16) 파이썬 파일 실행해보기
    - EC2 콘솔창에서 아래와 같이 입력합니다.

        ```bash
        # home 디렉토리로 이동
        cd ~
        
        # 실행. 콘솔창에 hellow world!가 뜨는 것을 확인 할 수 있습니다.
        python3 [test.py](http://test1.py)
        ```

- 17) 서버 환경 통일하기

    우리는 지금 막! 컴퓨터를 구매한 상태예요. 여기에 이런저런 세팅들(업그레이드, DB설치, 명령어 통일 등)을 해줘야 본격적으로 이용할 때 편리하답니다!

    - **[코드스니펫] - EC2 한방에 세팅하기**

        [initial_ec2.sh](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/initial_ec2.sh)

    [initial_ec2.sh](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/initial_ec2%201.sh)

    파일질라로 업로드하고, git bash(또는 터미널)에서 아래 코드를 차례대로 입력해주세요.

    3분 정도 기다리면 모든 세팅이 완료됩니다.

    ```bash
    sudo chmod 755 initial_ec2.sh
    ```

    ```bash
    ./initial_ec2.sh
    ```

- 18) 다시, 파이썬 파일을 실행해보기

    자 이제, python 이라고 입력해도 가능!

    ```bash
    python [test.py](http://test1.py)
    ```

- 19) [한 걸음 더] 서버 환경 세팅 - 혼자 해보기

    실제 업무에서는 아래 내용을 인프라 엔지니어 또는 개발 팀장님이 해두시는 경우가 많습니다. 튜터들도 모두 외우고 있는 코드가 아니기에, 맥락만 이해해주시면 되겠습니다!

    1. 한국시간 세팅

        EC2 컴퓨터의 시간대를 한국으로 맞추는 명령어

        ```bash
        sudo ln -sf /usr/share/zoneinfo/Asia/Seoul /etc/localtime
        ```

    2. 파이썬 (python3 → python)

        python3 명령어를 python으로 사용할 수 있게 하는 명령어

        ```bash
        sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 10
        ```

    3. pip (pip3 → pip)

        1) pip3 설치
        2) pip3 명령어를 pip으로 사용할 수 있게 하는 명령어

        * 한 줄 씩 복사 붙여넣기!

        ```bash
        # pip3 설치
        sudo apt-get update
        sudo apt-get install -y python3-pip

        # pip3 대신 pip 라고 입력하기 위한 명령어
        sudo update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 1
        ```

    4. mongoDB 설치
        - 1. mongoDB 설치 코드

            mongoDB 공식자료를 참고해서 정리했습니다. [(링크)](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/)
            한 줄 한 줄이 무슨 뜻인지는 지금 굳이 알 필요 없어요!

            ```bash
            wget -qO - https://www.mongodb.org/static/pgp/server-4.2.asc | sudo apt-key add -

            echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list

            sudo apt-get update

            sudo apt-get install -y mongodb-org
            ```

        - 2. mongoDB 실행하기

            ```bash
            # 실행. 아무 반응이 없으면, 잘 실행된 것!
            # 리눅스는 보통 잘 되면 아무것도 안나와요!^^;
            sudo service mongod start
            ```

        - 3. mongoDB 접속 계정 생성하기

            우리가 만든 mongoDB를 외부에 열어주기 전에, 접속에 필요한 아이디와 비밀번호를 세팅해봅시다! (설정 안하면 누구나 DB정보를 볼 수 있다는..!)

            ```bash
            mongo
            ```

            좌측에 '>' 표시가 나오면 성공적으로 MongoDB에 접속한 것입니다! 다음 명령어를 순차적으로 입력해주세요.

            눈치 채셨겠지만,
            test, test 자리에 내가 넣고 싶은 아이디/비밀번호를 넣으면 됩니다. (영어로..!)

            ```bash
            # admin으로 계정 바꾸기
            use admin;

            # 계정 생성하기
            db.createUser({user: "test", pwd: "test", roles:["root"]});
            ```

            아래와 같은 화면을 보면 완성!

            ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2020.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2020.png)

            ```bash
            # 나오기
            exit

            # MongoDB 재시작
            sudo service mongod restart
            ```

        - 4. mongoDB를 외부에 열어주기

            mongoDB는 디폴트로 내부에서만 접속을 허용하고 있습니다. 이 작업은 외부에서 접근이 가능하도록 잠금을 풀어주는 것입니다.

            리눅스 자체 에디터(고급 메모장 정도로 생각!)인 Vim이 등장합니다.
            `a` 를 눌러야 입력 모드가 되고, `:wq` 를 눌러야 저장하고 나올 수 있습니다.

            ```bash
            sudo vi /etc/mongod.conf

            # sudo: 관리자(SuperUser) 권한으로 다음을 실행
            # => "관리자 권한으로 /etc 폴더 아래 mongod.conf 파일을 Vim으로 켜줘!"라는 뜻입니다
            ```

            위 명령어를 실행하신 후, 아래 방향 화살 키를 누르시면 다음과 같은 내용이 보입니다.

            ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2021.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2021.png)

            ```bash
            # 입력 모드 전환
            i
            ```

            위 붉은 박스의 내용을 아래와 같이 바꿔주세요!

            ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2022.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2022.png)

            ```bash
            # 내용 저장하고 에디터 종료하기. esc 누르고 다음 입력.
            :wq

            # 재시작
            sudo service mongod restart
            ```

        - 5. Robo3T를 이용해서, "내 컴퓨터에서"→"서버에 있는 mongoDB"에 접속하기
            - 좌측 상단 빨간 상자 내 아이콘을 클릭합니다.

                ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2023.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2023.png)

            - Create 클릭!

                ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2024.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2024.png)

            - 접속 정보를 세팅합니다.

                ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2025.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2025.png)

            - 상단 Authentication 탭을 클릭합니다.
                1. Perform authentication 체크박스를 클릭합니다.
                2. 생성한 계정의 아이디와 비밀번호를 입력하고, 'save'를 클릭합니다.

                ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2026.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2026.png)

    5. 포트포워딩 (80포트 → 5000포트)

        80포트로 들어오는 요청을 5000포트로 넘겨주는 명령어

        ```bash
        sudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 5000
        ```

## **12. flask 서버를 실행해보기**

- 20) flask 서버를 실행해보기
    - 기초적인 flask 서버 파일을 하나 만들어봅니다.
        - **[코드스니펫] - app.py 파일 준비**

            ```python
            from flask import Flask
            app = Flask(__name__)
            
            @app.route('/')
            def home():
               return 'This is Home!'
            
            if __name__ == '__main__':  
               app.run('0.0.0.0', port=5000, debug=True)
            ```

    - filezilla를 통해 EC2에 업로드한 다음, 실행해봅니다.

        ```bash
        # 실행
        python app.py
        ```

        에러가 납니다! 뭐라고 에러가 나는가요?

        정답: flask 패키지가 없는데? - 라는 에러입니다.
        그럼, 패키지를 설치해볼까요?

- 21) pip로 패키지를 설치하기

    우리가 file → setting → .. 에서 `+` 버튼 누르고 설치했던 작업을, 명령어로 하면 이렇게 된답니다! 🤓

    ```bash
    pip install flask
    ```

- 22) 다시 flask 서버를 실행해보기
    - 아래 명령어로 flask 서버를 실행합니다.

        ```bash
        python app.py
        ```

    - 서버 실행이 되면, 크롬에서 접속을 해봅니다.

        ```bash
        크롬 브라우저 창에 아래와 같이 입력합니다.
        
        http://[내 EC2 IP]:5000/
        ```

        아직, 작동하지 않을 걸요! → AWS에서 약간의 설정이 더 필요합니다.

## 13**. AWS에서 포트 열어주기**

- 23) AWS에서 5000포트를 열어주기
    - EC2 서버(=가상의 내 컴퓨터)에서 포트를 따로 설정하는 것 외에도,
    AWS EC2에서도 자체적으로 포트를 열고/닫을 수 있게 관리를 하고 있습니다.

        → 그래서 AWS EC2 Security Group에서 인바운드 요청 포트를 열어줘야 합니다.

    - 일단, EC2 관리 콘솔로 들어갑니다. 그리고 보안그룹(영문: Security Group)을 눌러 들어갑니다. 여기선 launch-wizard-1 이라고 쓰여 있네요

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2027.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2027.png)

    - 해당 보안그룹을 클릭합니다.

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/_2020-03-23__9.41.03.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/_2020-03-23__9.41.03.png)

    - Edit inbound rules를 선택합니다.

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/_2020-03-23__9.41.18.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/_2020-03-23__9.41.18.png)

    - 세 가지 포트를 추가해봅니다.

        → 80포트: HTTP 접속을 위한 기본포트

        → 5000포트: flask 기본포트

        → 27017포트: 외부에서 mongoDB 접속을 하기위한 포트

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/_2020-03-23__9.42.08.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/_2020-03-23__9.42.08.png)

- 24) 다시 접속해봅니다!
    - http://내아이피:5000

        → 잘 작동하는 것을 확인할 수 있습니다.

    - 이제 [app.py](http://app.py) 파일을 수정하고, 다듬어서 올리면 진짜 프로젝트가 되겠죠?

## 14**. 원페이지쇼핑몰 업로드해보기**

- 25) Robo3T를 이용해서, "내 컴퓨터에서"→"서버에 있는 mongoDB"에 접속하기
    - 좌측 상단 빨간 상자 내 아이콘을 클릭합니다.

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2023.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2023.png)

    - Create 클릭!

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2024.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2024.png)

    - 접속 정보를 세팅합니다.

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2025.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2025.png)

    - 상단 Authentication 탭을 클릭합니다.
        1. Perform authentication 체크박스를 클릭합니다.
        2. 생성한 계정의 아이디와 비밀번호를 입력하고, 'save'를 클릭합니다.

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2026.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2026.png)

- 26) 원페이지쇼핑몰 완성본을 filezilla로 EC2에 업로드해봅니다.
    - 그 전에! MongoDB 접속 세팅을 바꿔주세요!

        AWS의 MongoDB에 아이디와 비밀번호를 추가했으니, 우리의 pymongo에도 아이디와 비밀번호를 입력해주어야 합니다! 그래야 pymongo가 올바르게 DB에 접근할 수 있습니다.

        [app.py](http://app.py) 파일을 열어서,
        아래 처럼 가운데 한 줄을 바꿔주세요!

        - **[코드스니펫] - pymongo 계정 접속**

            ```python
            client = MongoClient('mongodb://test:test@localhost', 27017)
            ```

        아래와 같은 뜻이에요!

        ```python
        client = MongoClient('mongodb://아이디:비밀번호@localhost', 27017)
        ```

    - 파일질라에서 homework 폴더 째로 드래그 드롭으로 EC2 인스턴스의 home/ubuntu 폴더에 업로드합니다.
- 27) 완성본을 실행해봅니다.
    - 실행하려고 시도하기

        ```bash
        # home 디렉토리로 이동
        cd ~

        # 해당 폴더로 이동해서 아래 코드를 실행합니다.
        python app.py
        ```

    - 에러가 나죠? 패키지를 설치하지 않았기 때문입니다.

        ```bash
        # 설치하기
        pip install pymongo
        ```

    - 다시 실행해봅니다

        ```bash
        python app.py
        ```

- 28) 접속해봅니다!
    - 브라우저에서 접속하기

        ```bash
        http://내AWS아이피:5000/
        ```

## 15**. 포트포워딩**

- 29) 포트 번호를 떼고 접속해봅니다!

    앗, 어떻게 되는걸까! → 아까 세팅해뒀으니까요~! 🤗

    ```bash
    http://내AWS아이피/
    ```

- 30) 포트 번호 없애기 - 기본 개념

    우리는 이미 포트포워딩 세팅을 해뒀기 때문에, 여기서는 개념만!

    - 지금은 5000포트에서 웹 서비스가 실행되고 있습니다. 그래서 매번 :5000 이라고 뒤에 붙여줘야 하죠. 뒤에 붙는 포트 번호를 없애려면 어떻게 해야할까요?
    - http 요청에서는 80포트가 기본이기 때문에, 굳이 :80을 붙이지 않아도 자동으로 연결이 됩니다.
    - 포트 번호를 입력하지 않아도 자동으로 접속되기 위해, 우리는 80포트로 오는 요청을 5000 포트로  전달하게 하는 포트포워딩(port forwarding) 을 사용하겠습니다.
    - 리눅스에서 기본으로 제공해주는  포트포워딩을 사용할 것입니다. 그림으로 보면 아래와 같습니다.

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2028.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2028.png)

## 16**. nohup 설정하기**

- 31) SSH 접속을 끊어도 서버가 계속 돌게 하기
    - 현재 상황

        Git bash 또는 맥의 터미널을 종료하면 (=즉, SSH 접속을 끊으면) 프로세스가 종료되면서, 서버가 돌아가지 않고 있습니다. 그러나 우리가 원격접속을 끊어도, 서버는 계속 동작해야겠죠?

    - 원격 접속을 종료하더라도 서버가 계속 돌아가게 하기

        ```bash
        # 아래의 명령어로 실행하면 된다
        nohup python app.py &
        ```

    - 서버 종료하기 - 강제종료하는 방법

        ```bash
        # 아래 명령어로 미리 pid 값(프로세스 번호)을 본다
        ps -ef | grep 'app.py'

        # 아래 명령어로 특정 프로세스를 죽인다
        kill -9 [pid값]
        ```

    - 다시 켜기

        ```bash
        nohup python app.py &
        ```

- 32) SSH 접속을 종료한 뒤, 접속해봅니다!
    - 브라우저에서 접속하기

        ```bash
        http://내AWS아이피/
        ```

→ **서버종료가 왜 중요하냐면, 내 서버에 파일 수정해서 올리거나 할때, 종료하고 올리고 다시 켜야 하니까 자주 하는 작업임**

## 17**. 도메인 구입하기**

- 33) 도메인 구입/연결
    - 도메인을 구매한다는 것은, 네임서버를 운영해주는 업체에, IP와 도메인 매칭 유지비를 내는 것입니다. 한국 또는 글로벌 업체 어디든 상관 없지만, 우리는 한국의 '가비아'라는 회사에서 구입해보겠습니다.
- 34) 구입 후 아래 화면을 띄워주세요
    - 링크: [https://my.gabia.com/service#/](https://my.gabia.com/service#/)

        (DNS 관리툴 클릭)

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2029.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2029.png)

        (도메인 연결 클릭)

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2030.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2030.png)

        (DNS 설정 클릭)

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2031.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2031.png)

        (호스트 이름에 @, IP주소에 IP주소를 입력합니다)

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2032.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2032.png)

        (이렇게!)

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2033.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2033.png)

- 35) 10분 정도 기다려주세요!
    - 네임서버에 내 도메인-IP가 매칭되는 시간이 필요합니다.
- 36) IP주소로 접근해보기
    - 내 IP주소로 지금 flask 서버가 잘 돌고 있나요? 먼저 확인해봅니다.

        ```bash
        http://내AWS아이피/
        ```

    - 약간의 시간을 가진 후, 내 도메인으로 접근하면, 접속이 됩니다.

        ```bash
        http://내도메인/
        ```

## 18**. og 태그**

- 37) og 태그 만들기
    - 나홀로메모장에서 배웠던 og:image, og:title, og:description 태그 기억하시나요?

        내 프로젝트도 카톡/페이스북/슬랙에 공유했을 때 예쁘게 나오도록,
        미리 꾸며봅시다!

        ![5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2034.png](5%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%A8%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%20d8f713ef7d114739885062ea098b2844/Untitled%2034.png)

    - static 폴더 아래에 이미지 파일을 넣고, 각자 프로젝트 HTML의 <head>~</head> 사이에 아래 내용을 작성하면 og 태그를 개인 프로젝트에 사용할 수 있습니다.

        1. "내 사이트의 제목" 입력하기
        2. "보고 있는 페이지의 내용 요약" 입력하기
        3. 적당한 이미지를 만들거나/골라서 static폴더에 ogimage.png로 저장하기!
        (사이즈 800x400인 이미지를 구글에서 검색!)

        - **[코드스니펫] - og태그 넣기**

            ```jsx
            <meta property="og:title" content="내 사이트의 제목" />
            <meta property="og:description" content="보고 있는 페이지의 내용 요약" />
            <meta property="og:image" content="{{ url_for('static', filename='ogimage.png') }}" />
            ```

    - 참고! 이미지를 바꿨는데 이전 ogimage가 그대로 나와요!

        그것은 페이스북/카카오톡 등에서 처음 것을 한동안 저장해놓기 때문입니다.

        - 페이스북 og 태그 초기화 하기: [https://developers.facebook.com/tools/debug/](https://developers.facebook.com/tools/debug/)
        - 카카오톡 og 태그 초기화 하기: [https://developers.kakao.com/tool/clear/og](https://developers.kakao.com/tool/clear/og)

---

**🎉 와! 수료를 축하합니다!!🎉**

이로써 5주 간의 모든 수업이 끝났습니다. 의미있고 뿌듯했던 5주로 기억되길 진심으로 바랍니다. 새로운 강의로 찾아뵐게요. 많은 기대 부탁드려요!

또 만나요~!😍 (그러나! 마지막 숙제가 아래에 있다는 사실! 😎 )

## **19. 5주차 끝 & 숙제 설명**

**내 도메인을 제출해주세요!**

착착착 잘 따라오셨다면, 원페이지 쇼핑몰을 EC2에 잘 올려두셨을 거예요.

- 열심히 돌아가고 있는 나의 웹서비스를 제출하시면, 이번 숙제는 끝이랍니다~!🤓

Copyright ⓒ TeamSparta All rights reserved.