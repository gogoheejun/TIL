# M:N 관계

A 테이블에서 B테이블을 볼땐 1:M인데, B테이블에서 A테이블을 봐도 1:M인 경우임. 

즉 M:N임

즉 아래처럼 개념상으론 가능해.

![Untitled](https://user-images.githubusercontent.com/78577071/127800297-26d3d195-00e0-4b56-afd3-c00cbd6470cc.png)

근데 각 테이블에 PK와 FK가 없잖아. 그래서 한번 넣어보면,,,아래처럼 문제가 발생해

![Untitled 1](https://user-images.githubusercontent.com/78577071/127800328-edb030fa-f90a-4793-9582-5bcfc17996f0.png)

 그럼 어떻게 해결?

"학생이 과목을 수강합니다" 라는 주문은 

"학생, 과목, 수강" 테이블로 표현됨. 이중 명사인 학생과 과목은 관계가 없어.  '수강'이라는 **동사**가 중요함.

명사로서 존재하는 테이블: **마스터테이블→**웬만해선 변동이 없음.(학생의 경우 졸업하고 신입생오고 전학가고 오고 그런것만 있으니 전체수는 거의 비슷...과목숫자도 그래봣자 미술체육수학 별로 안변해서 비슷.)

동사로 표현되는 테이블: **관계테이블→** 누가 언제 어떤과목을 수강했다.이므로 계속 변함 수강 계속 바뀜. 얘가 비즈니스 로직을 완성시킴

![Untitled 2](https://user-images.githubusercontent.com/78577071/127800333-f97b846a-69da-475d-a0dd-ceed56f9e2d3.png)

즉 

학생:수강  → 1:M ,

수강:과목 → N:1 

관계이므로 양쪽1 없애면 M:N됨

관계도 그려보면

![Untitled 3](https://user-images.githubusercontent.com/78577071/127800343-a07d481c-58f8-4c90-bc74-b978b55ab74f.png)

이런 관계는 수강말고 실생활에 매우 다양

단체가입, 돈을 비려주는 관계 등등.

암튼, 위 수강과목에서 수강이라는 관계테이블에서 **학생과 과목이라는 두 FK**를 끄집어냈을때 **해석이 되어야 좋은 관계테이블**이라 할 수 있음

---

다시한번 예시, 

고객, 상품 테이블이 있다고 치자.

고객과 상품은 아무 관계가 없어. 버스와 좌석은 관계가 있는데 이것과 달라.

고객이 하난데 상품이 여러개? 상품이 하난데 고객이 여러개? 말이 안돼. 단, 고객이 상품을 사는 건 말이 돼. **즉 '사다(가지다)'라는 관계테이블이 필요함.**

---

- PK구성은 어떻게 해야 하는가?

만약 다음처럼 FK를 PK로 가지고있다는건 무슨의미?

![Untitled 4](https://user-images.githubusercontent.com/78577071/127800350-7cee2218-aad1-49fa-abf3-d4441fb6148e.png)

학생id 또는 과목id 하나씩만 볼땐 fk이지만, 둘이 한 줄(1 A)을 같이 볼땐 PK로 해석. 1A,1C,2A이렇게 합치면 유니크하므로 pk가 되는것임. 

이때의 장점: 같은 학생이 같은과목을 중복수강 못하게 막을 수 있음.

근데 같은 정보가 중복을 허용해야 하는 비즈니스 로직이 있을 때도 있음. 김종남이란 학생이 연필을 샀어. 여러번 샀을 수도 있잖아. 그럼 '구매'라는 테이블에 기록 남아야하니까 그땐 위처럼 두개를 섞어서 pk만들면 안됨.이땐 PK를 독립시켜야 함

---

- 후보키(AK..alternate key..대체키)

만약 FK가 테이블에 여러개가 있는 상황(중복을 받지 않기 위해 그럴 수있음). 이 테이블에서 select를 하려면 그 FK들을 where절로 다~~~쳐야지 내가 원하는 값이 select됨 그래야지 유니크한 pk가 성립되니까. 이거 너무 힘들어.

→Not NUll이면서 Unique한 애로 후보키를 만든다. 대신 PK로 등록을 못하는 것임

이제 sql쉬워짐

![Untitled 5](https://user-images.githubusercontent.com/78577071/127800355-68074a0d-cca5-4ee6-a35a-de6059ead3d4.png)

```sql
select * from 수강 where 학생id='1' and 과목id='2' and dsdsf and adflsd and ldjf and dsfoi

위처럼 힘든걸

select* from 수강 where seq = 5 하면 끝
```
